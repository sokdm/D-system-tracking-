<!DOCTYPE html>
<html>
<head>
<title>DHL Admin Dashboard</title>

<style>
body{
    font-family:Arial;
    background:#ffcc00;
    margin:0;
}

.header{
    background:#cc0000;
    color:white;
    padding:20px;
    text-align:center;
    font-size:28px;
    font-weight:bold;
}

.container{
    padding:20px;
}

.btn{
    padding:12px 20px;
    margin:5px;
    background:#cc0000;
    color:white;
    border:none;
    border-radius:10px;
    cursor:pointer;
}

table{
    width:100%;
    background:white;
    border-collapse:collapse;
}

th,td{
    padding:12px;
    border-bottom:1px solid #ddd;
    text-align:center;
}

th{
    background:#cc0000;
    color:white;
}

img{
    width:60px;
    border-radius:8px;
}
</style>
</head>

<body>

<div class="header">ðŸšš DHL Delivery Admin Dashboard</div>

<div class="container">

<button class="btn" onclick="goUpload()">ðŸ“¦ Upload</button>
<button class="btn" onclick="loadPackages()">ðŸ”„ Refresh</button>
<button class="btn" onclick="logout()">ðŸšª Logout</button>

<table>
<thead>
<tr>
<th>Tracking</th>
<th>Name</th>
<th>Phone</th>
<th>Status</th>
<th>Image</th>
<th>Receipt</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>
</table>

</div>

<script>

const API="/api/packages"

if(!localStorage.getItem("adminToken")){
    window.location="/admin-login.html"
}

async function loadPackages(){

    const res = await fetch(API+"/all")
    const data = await res.json()

    tableBody.innerHTML=""

    data.forEach(pkg=>{

        tableBody.innerHTML+=`
        <tr>
        <td>${pkg.trackingCode}</td>
        <td>${pkg.customerName}</td>
        <td>${pkg.phone}</td>

        <td>
        <select onchange="changeStatus('${pkg._id}',this.value)">
            ${opt(pkg.status,"Pending")}
            ${opt(pkg.status,"Shipped")}
            ${opt(pkg.status,"Moving")}
            ${opt(pkg.status,"Stopped")}
            ${opt(pkg.status,"Reached Destination")}
            ${opt(pkg.status,"Delivered")}
        </select>
        </td>

        <td>
        ${pkg.image ? `<img src="/uploads/${pkg.image}">` : "No Image"}
        </td>

        <td>
        <button class="btn" onclick="printReceipt('${pkg.trackingCode}')">ðŸ§¾ Print</button>
        </td>

        </tr>
        `
    })
}

function opt(cur,val){
return `<option ${cur===val?"selected":""}>${val}</option>`
}

async function changeStatus(id,status){
await fetch(API+"/status/"+id,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({status})
})
alert("Updated")
}

async function printReceipt(code){
const res=await fetch(API+"/receipt/"+code)
const d=await res.json()

const w=window.open("")
w.document.write(`
<h2>DHL DELIVERY RECEIPT</h2>
<p><b>Tracking:</b> ${d.trackingCode}</p>
<p><b>Name:</b> ${d.customerName}</p>
<p><b>Phone:</b> ${d.phone}</p>
<p><b>Address:</b> ${d.address}</p>
<p><b>Weight:</b> ${d.weight}</p>
<p><b>Status:</b> ${d.status}</p>
<p><b>Date:</b> ${new Date(d.createdAt).toLocaleString()}</p>
`)
w.print()
}

function goUpload(){
window.location="/upload.html"
}

function logout(){
localStorage.removeItem("adminToken")
window.location="/admin-login.html"
}

loadPackages()

</script>

</body>
</html>
