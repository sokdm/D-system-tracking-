<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DHL Delivery Tracking</title>

<style>
body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(135deg,#ffcc00,#ff6600);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

.container{
    width:95%;
    max-width:900px;
    background:white;
    padding:40px;
    border-radius:25px;
    box-shadow:0 25px 60px rgba(0,0,0,0.25);
}

h1{
    text-align:center;
    color:#cc0000;
}

.subInfo{
    text-align:center;
    color:#666;
    font-size:14px;
    margin-bottom:20px;
}

.searchBox{
    text-align:center;
    margin-bottom:30px;
}

input{
    width:70%;
    padding:15px;
    font-size:18px;
    border-radius:12px;
    border:2px solid #eee;
}

button{
    padding:15px 35px;
    font-size:18px;
    border:none;
    border-radius:12px;
    background:#cc0000;
    color:white;
    cursor:pointer;
    margin-left:10px;
}

#result{
    display:none;
}

/* STATUS COLORS */
.status{
    font-weight:bold;
    padding:8px 14px;
    border-radius:10px;
    display:inline-block;
}

.status-pending{ background:#fff3cd; color:#856404; }
.status-transit{ background:#cce5ff; color:#004085; }
.status-customs{ background:#e2d9f3; color:#4b2c7a; }
.status-delivery{ background:#ffe5d0; color:#a04000; }
.status-delivered{ background:#d4edda; color:#155724; }

/* PROGRESS */
.progress{
    background:#eee;
    height:12px;
    border-radius:20px;
    overflow:hidden;
    margin:20px 0;
}

.progress-bar{
    height:100%;
    background:#28a745;
    width:0%;
    transition:1s ease;
}

/* TIMELINE */
.timeline{
    margin-top:30px;
}

.timeline-item{
    border-left:4px solid #ccc;
    padding-left:15px;
    margin-bottom:20px;
}

.timeline-item.active{
    border-color:#28a745;
}

.timeline-time{
    font-size:14px;
    color:#777;
}

.timeline-location{
    font-weight:bold;
}

/* INFO GRID */
.info-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
}

.info-box{
    background:#fafafa;
    padding:20px;
    border-radius:15px;
}

.locationBox{
    background:#e8f5e9;
    padding:15px;
    border-radius:12px;
    margin-top:15px;
    font-weight:bold;
}

/* EXTRA DASHBOARD TEXT */
.dashboardNote{
    background:#fff8e1;
    padding:15px;
    border-radius:12px;
    margin-top:20px;
    font-size:14px;
    color:#6b4f00;
}

img{
    width:100%;
    border-radius:15px;
    margin-top:20px;
}

@media(max-width:700px){
    .info-grid{
        grid-template-columns:1fr;
    }
}
</style>
</head>

<body>

<div class="container">

<h1>üì¶ DHL Delivery Tracking</h1>

<div class="subInfo">
Real-time logistics monitoring ‚Ä¢ Secure shipment tracking ‚Ä¢ Global delivery network
</div>

<div class="searchBox">
<input id="code" placeholder="Enter Tracking Code">
<button onclick="track()">Track</button>
</div>

<div id="result"></div>

</div>

<script>

function formatDate(date){
    if(!date) return "-"
    try{
        return new Date(date).toLocaleString()
    }catch{
        return date
    }
}

function getProgress(status, timeline){
    if(timeline && timeline.length){
        return Math.min(100, timeline.length * 20)
    }

    if(!status) return 10

    status = status.toLowerCase()

    if(status.includes("pending")) return 15
    if(status.includes("picked")) return 30
    if(status.includes("transit")) return 55
    if(status.includes("custom")) return 70
    if(status.includes("delivery")) return 90
    if(status.includes("delivered")) return 100

    return 25
}

/* STATUS COLOR PICKER */
function getStatusClass(status){
    if(!status) return "status status-pending"

    status = status.toLowerCase()

    if(status.includes("pending")) return "status status-pending"
    if(status.includes("transit")) return "status status-transit"
    if(status.includes("custom")) return "status status-customs"
    if(status.includes("delivery")) return "status status-delivery"
    if(status.includes("delivered")) return "status status-delivered"

    return "status status-pending"
}

async function track(){

const code = document.getElementById("code").value.trim()
const result = document.getElementById("result")

if(!code){
    result.style.display="block"
    result.innerHTML="<b>Enter tracking code</b>"
    return
}

result.style.display="block"
result.innerHTML="Loading tracking info..."

try{

const res = await fetch("/api/packages/track/" + code)

if(res.status !== 200){
    result.innerHTML="<b style='color:red'>Package Not Found</b>"
    return
}

const data = await res.json()

const timeline = Array.isArray(data.timeline) ? data.timeline : []
const progress = getProgress(data.status, timeline)
const statusClass = getStatusClass(data.status)

const historyHTML = timeline.map(step => `
<div class="timeline-item active">
<div class="timeline-location">${step.location || "-"}</div>
<div>${step.status || "-"}</div>
<div class="timeline-time">${formatDate(step.date)}</div>
</div>
`).reverse().join("")

result.innerHTML = `

<h2>Tracking Code: ${data.trackingCode || "-"}</h2>

<div class="progress">
<div class="progress-bar" style="width:${progress}%"></div>
</div>

<h3>Status: <span class="${statusClass}">${data.status || "-"}</span></h3>

<div class="locationBox">
üìç Current Location: ${data.currentLocation || "Unknown"}
</div>

<div class="info-grid">

<div class="info-box">
<h3>Receiver</h3>
<p><b>Name:</b> ${data.customerName || "-"}</p>
<p><b>Phone:</b> ${data.phone || "-"}</p>
<p><b>Address:</b> ${data.address || "-"}</p>
<p><b>Country:</b> ${data.country || data.destinationCountry || "-"}</p>
</div>

<div class="info-box">
<h3>Shipment</h3>
<p><b>Weight:</b> ${data.weight || "-"}</p>
<p><b>Description:</b> ${data.description || "-"}</p>
<p><b>Departure:</b> ${data.departureDate || "-"}</p>
<p><b>Arrival:</b> ${data.arrivalEstimate || "-"}</p>
</div>

</div>

<div class="dashboardNote">
‚úî Shipment updates automatically as it moves through checkpoints<br>
‚úî Customs clearance and transit updates appear in real time<br>
‚úî Final delivery confirmation will appear once package is received
</div>

<h3>Shipment History</h3>
<div class="timeline">
${historyHTML || "No movement history yet"}
</div>

${data.image ? `<img src="/uploads/${data.image}">` : ""}

`

}catch(err){
result.innerHTML="<b style='color:red'>Server Error</b>"
}

}

</script>

</body>
</html>
