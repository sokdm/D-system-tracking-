<!DOCTYPE html>
<html>
<head>
<title>Shipment Receipt</title>

<style>

body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:linear-gradient(135deg,#f5f5f5,#e9e9e9);
}

.header{
background:#cc0000;
color:white;
text-align:center;
padding:25px;
font-size:26px;
font-weight:bold;
}

.card{
background:white;
width:92%;
max-width:560px;
margin:30px auto;
padding:30px;
border-radius:18px;
box-shadow:0 15px 30px rgba(0,0,0,0.15);
}

.code{
font-size:22px;
font-weight:bold;
color:#cc0000;
margin-bottom:10px;
text-align:center;
cursor:pointer;
}

.copyBtn{
display:block;
margin:0 auto 20px auto;
padding:10px 20px;
border:none;
border-radius:8px;
background:#cc0000;
color:white;
font-weight:bold;
cursor:pointer;
}

.section{
margin-top:25px;
}

.section h3{
border-bottom:2px solid #eee;
padding-bottom:6px;
margin-bottom:10px;
}

.line{
margin:8px 0;
font-size:15px;
}

img{
width:100%;
border-radius:12px;
margin-top:20px;
}

/* STATUS COLORS */
.status{
font-weight:bold;
}

.pending{ color:#ff9800; }
.moving{ color:#2196f3; }
.delivered{ color:#4caf50; }
.stopped{ color:#f44336; }

/* TIMELINE */
.timeline{
margin-top:25px;
border-left:3px solid #cc0000;
padding-left:15px;
}

.timeline-item{
margin-bottom:15px;
}

.timeline-location{
font-weight:bold;
}

.timeline-date{
font-size:13px;
color:#777;
}

/* TOAST */
.toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#333;
color:white;
padding:12px 20px;
border-radius:8px;
opacity:0;
transition:0.4s;
}

.toast.show{
opacity:1;
}

</style>
</head>

<body>

<div class="header">
ðŸ“¦ SHIPMENT RECEIPT
</div>

<div class="card">

<div class="code" id="code" onclick="copyCode()">Loading...</div>
<button class="copyBtn" onclick="copyCode()">Copy Tracking Code</button>

<div class="section">
<h3>Receiver Information</h3>
<div class="line" id="name"></div>
<div class="line" id="phone"></div>
<div class="line" id="address"></div>
</div>

<div class="section">
<h3>Shipment Information</h3>
<div class="line" id="weight"></div>
<div class="line" id="departure"></div>
<div class="line" id="arrival"></div>
<div class="line" id="desc"></div>
<div class="line status" id="status"></div>
</div>

<div class="section">
<h3>Tracking History</h3>
<div id="timeline" class="timeline"></div>
</div>

<img id="image" style="display:none"/>

</div>

<div id="toast" class="toast">Copied</div>

<script>

let currentCode = ""

const url = new URLSearchParams(window.location.search)
const code = url.get("code")

if(!code){
document.getElementById("code").innerText = "No Tracking Code"
}else{
loadReceipt(code)
}

function formatDate(d){
if(!d) return ""
return new Date(d).toLocaleString()
}

function statusClass(status){
if(!status) return ""
status = status.toLowerCase()
if(status.includes("pending")) return "pending"
if(status.includes("moving")) return "moving"
if(status.includes("deliver")) return "delivered"
if(status.includes("stop")) return "stopped"
return ""
}

async function loadReceipt(code){

try{

const res = await fetch("/api/packages/receipt/" + code)
const data = await res.json()

currentCode = data.trackingCode || ""

document.getElementById("code").innerText =
currentCode || "No Code"

document.getElementById("name").innerText =
"Name: " + (data.customerName || "")

document.getElementById("phone").innerText =
"Phone: " + (data.phone || "")

document.getElementById("address").innerText =
"Address: " + (data.address || "")

document.getElementById("weight").innerText =
"Weight: " + (data.weight || "")

document.getElementById("departure").innerText =
"Departure: " + formatDate(data.departureDate)

document.getElementById("arrival").innerText =
"Arrival Estimate: " + formatDate(data.arrivalEstimate)

document.getElementById("desc").innerText =
"Description: " + (data.description || "")

const statusEl = document.getElementById("status")
statusEl.innerText = "Status: " + (data.status || "")
statusEl.className = "line status " + statusClass(data.status)

/* IMAGE */
if(data.image){
const img = document.getElementById("image")
img.src = "/uploads/" + data.image
img.style.display = "block"
}

/* TIMELINE */
const timeline = document.getElementById("timeline")
timeline.innerHTML = ""

if(data.timeline && data.timeline.length){

data.timeline.reverse().forEach(t=>{
timeline.innerHTML += `
<div class="timeline-item">
<div class="timeline-location">${t.location || ""}</div>
<div>${t.status || ""}</div>
<div class="timeline-date">${formatDate(t.date)}</div>
</div>
`
})

}else{
timeline.innerHTML = "<i>No tracking history yet</i>"
}

}catch(err){
document.getElementById("code").innerText = "Error Loading Receipt"
}

}

/* COPY CODE */
function copyCode(){

if(!currentCode) return

navigator.clipboard.writeText(currentCode)

const toast = document.getElementById("toast")
toast.classList.add("show")

setTimeout(()=>{
toast.classList.remove("show")
},2000)

}

</script>

</body>
</html>
